datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["recipe"]
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

model Recipe {
  id          String       @id @default(cuid())
  title       String
  slug        String       @unique
  coverImage  String?
  notes       String?      // tip → notes로 통일
  rating      Int          @default(3) // 1-5 (difficulty → rating으로 통일)
  category    String?      // 예: "국/찌개", "볶음", "무침" 등
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  ingredients Ingredient[]
  steps       Step[]
  tags        RecipeTag[]
  
  @@schema("recipe")
}

model Ingredient {
  id       String @id @default(cuid())
  name     String
  amount   String
  order    Int    @default(0)
  recipeId String
  recipe   Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  
  @@schema("recipe")
}

model Step {
  id          String @id @default(cuid())
  instruction String
  order       Int
  recipeId    String
  recipe      Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  
  @@schema("recipe")
}

model RecipeTagMaster {
  id      String      @id @default(cuid())
  name    String      @unique
  recipes RecipeTag[]
  
  @@map("Tag")
  @@schema("recipe")
}

model RecipeTag {
  recipeId String
  tagId    String
  recipe   Recipe           @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  tag      RecipeTagMaster  @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([recipeId, tagId])
  @@schema("recipe")
}

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  order     Int      @default(0) // 정렬 순서
  createdAt DateTime @default(now())
  
  @@schema("recipe")
}
